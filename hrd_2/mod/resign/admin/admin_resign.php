<?phpif (!defined('AURACMS_admin')) {	Header("Location: ../../../index.php");	exit;}if (!cek_login ()){   $admin .='<p class="judul">Access Denied !!!!!!</p>';   exit;}$style_include[] = '<link rel="stylesheet" media="screen" href="mod/calendar/css/dynCalendar.css" />';$admin .= '<script language="javascript" type="text/javascript" src="mod/calendar/js/browserSniffer.js"></script><script language="javascript" type="text/javascript" src="mod/calendar/js/dynCalendar.js"></script>';$tanggalresign = <<<eof<script language="JavaScript" type="text/javascript">        /**    * Example callback function    */    /*<![CDATA[*/    function exampleCallback_ISO3(date, month, year)    {        if (String(month).length == 1) {            month = '0' + month;        }            if (String(date).length == 1) {            date = '0' + date;        }            document.forms['posts'].tglresign.value = year + '-' + month + '-' + date;    }    calendar3 = new dynCalendar('calendar3', 'exampleCallback_ISO3');    calendar3.setMonthCombo(true);    calendar3.setYearCombo(true);/*]]>*/     </script>eof;$JS_SCRIPT= <<<js<script language="JavaScript" type="text/javascript">$(document).ready(function() {    $('#example').dataTable();} );</script>js;$script_include[] = $JS_SCRIPT;global $maxadmindata;if (isset ($_GET['pg'])) $pg = int_filter ($_GET['pg']); else $pg = 0;if (isset ($_GET['stg'])) $stg = int_filter ($_GET['stg']); else $stg = 0;if (isset ($_GET['offset'])) $offset = int_filter ($_GET['offset']); else $offset = 0;$normal2 = 'mod/karyawan/images/lampiran/';$temp2 = 'mod/karyawan/images/temp/';$admin  .='<h4 class="page-header">Administrasi Karyawan</h4>';$admin .='<ol class="breadcrumb"><li><a href="?pilih=mnkaryawan&amp;mod=yes">Home</a></li><li><a href="?pilih=karyawan&amp;mod=yes&amp;aksi=tambah_ckaryawan">Tambah Calon Karyawan</a></li><li><a href="?pilih=karyawan&amp;mod=yes&amp;aksi=cari_ckaryawan">Cari Calon Karyawan</a></li><li><a href="?pilih=karyawan&amp;mod=yes&amp;aksi=tambah_karyawan">Tambah Karyawan</a></li><li><a href="?pilih=karyawan&amp;mod=yes&amp;aksi=cari_karyawan">Cari Karyawan</a></li><li><a href="?pilih=karyawan&amp;mod=yes&amp;aksi=rekap_karyawan">Rekap Karyawan</a></li><li><a href="?pilih=resign&amp;mod=yes&amp;aksi=cari_karyawan">Karyawan Resign</a></li></ol>';#################################### List karyawan###################################if($_GET['aksi']==""){$admin .='<h5>Data Karyawan Resign</h5><table id="example"class="table table-striped table-bordered" cellspacing="0" width="100%"><thead><tr><th>NIP</th><th>Nama</th><th>TglLahir</th><th>Agama</th><th>Pendidikan</th><th>Jabatan</th><th>Status</th><th>Lama Kerja</th><th>Tgl Resign</th><th>Aksi</th></tr></thead>';$admin.='<tbody>';$hasil = $koneksi_db->sql_query( "SELECT * FROM hrd_karyawan where tipe='2'" );while ($data = $koneksi_db->sql_fetchrow($hasil)) { $nip=$data['nip'];$nama=$data['nama'];$gambar = $data['foto'];$date2 = $data['tglditerima'];$date3 = date("Y-m-d");$tgllahir 	= datetimes($data['tgllahir'],False,False);$lamakerja =  floor(daysBetween($date2, $date3));$lamakerja2 = floor($lamakerja/365);$admin.='<tr><td>'.$nip.'</td><td>'.$nama.'</td><td>'.$tgllahir.'</td><td>'.getagama($data['agama']).'</td><td>'.getpendidikan($data['pendidikan_terakhir']).'</td><td>'.getjabatan($data['jabatan']).'</td><td>'.getstatus($data['status']).'</td><td>'.$lamakerja2.' Tahun</td><td>'.datetimes($data['tglresign'],False,false).'</td>';$admin.='<td><a class="text-info" href="?pilih=resign&amp;mod=yes&amp;aksi=add_resign&amp;id='.$data['id'].'"><span class="btn btn-info">Resign</span></a></td></tr>';}$admin .= '</tbody></table>';if($jumlah>$limit){if (empty($_GET['offset']) and !isset ($_GET['offset'])) {	$offset = 0;}if (empty($_GET['pg']) and !isset ($_GET['pg'])) {	$pg = 1;}if (empty($_GET['stg']) and !isset ($_GET['stg'])) {	$stg = 1;}$admin .='<div class="border"><center>';$admin .= $ada-> getPaging($jumlah, $pg, $stg);$admin .='</center></div>';}}#################################### Tambah Berkas###################################if($_GET['aksi']=="add_resign"){$id     = int_filter($_GET['id']);$s = $koneksi_db->sql_query( "SELECT * FROM hrd_karyawan WHERE id=$id and tipe='0'");$datas = $koneksi_db->sql_fetchrow($s);$nama = $datas['nama'];$admin .='<h5 class="bg">Edit Karyawan dengan nama <strong>'.$nama.'</strong></h5>';if (isset($_POST['submit'])){	define("GIS_GIF", 1);define("GIS_JPG", 2);define("GIS_PNG", 3);define("GIS_SWF", 4);include "includes/hft_image.php";$nip  			= $_POST['nip'];$gambartambahan = $_FILES['gambartambahan']['name'];$tipe  			= $_POST['tipe'];$tglresign  			= $_POST['tglresign'];$alasan  			= $_POST['alasan'];$lampiranlama  			= $_POST['lampiranlama'];$total = $koneksi_db->sql_query( "SELECT * FROM hrd_karyawan WHERE nip = '".$_POST['nip']."' and id != '".$id."'");$jumlah = $koneksi_db->sql_numrows( $total );$error = '';if ($jumlah) $error .= "Error: NIP karyawan $nip sudah ada di dalam database!<br />";if (!$nip)  $error .= "Error: NIP wajib diisi!<br />";if (!$tipe)  $error .= "Error: Tipe wajib diisi!<br />";if ($error){$admin.='<div class="alert alert-danger">'.$error.'</div>';}else{if (!empty ($gambartambahan)){$files     = $_FILES['gambartambahan']['name'];$tmp_files = $_FILES['gambartambahan']['tmp_name'];$simpan    = md5 (rand(1,100).$files) .'.jpg';$uploaddir = $temp2 . $simpan; $uploads   = move_uploaded_file($tmp_files, $uploaddir);	if (file_exists($uploaddir)){		@chmod($uploaddir,0644);	}$large = $normal2 . $simpan;create_thumbnail ($uploaddir, $large, $new_width = 600, $new_height = auto, $quality = 100);unlink($uploaddir);$nfotolama = $normal2 . $lampiranlama;unlink($nfotolama); $hasil = $koneksi_db->sql_query( "update hrd_karyawan set tipe='$tipe',tglresign='$tglresign',alasan='$alasan',lampiran='$simpan' where id='$id'" );}else{$hasil = $koneksi_db->sql_query( "update hrd_karyawan set tipe='$tipe',tglresign='$tglresign',alasan='$alasan' where id='$id'" );}}}$hasil = $koneksi_db->sql_query( "SELECT * FROM hrd_karyawan WHERE id=$id" );$data = $koneksi_db->sql_fetchrow($hasil);$idkary  			= $data['id'];$nip  			= $data['nip'];$nama     		= text_filter($data['nama']);$departemen 	= $data['departemen'];$jabatan		= $data['jabatan'];$status		= $data['status'];$fotolama 	= $data['foto'];$tipe 	= $data['tipe'];$tglresign 	= $data['tglresign'];$alasan 	= $data['alasan'];$lampiran 	= $data['lampiran'];$lampiranlama 	= $data['lampiran'];$admin .= '<form class="form-inline" method="post" action="" enctype ="multipart/form-data" id="posts"><table class="table table-striped table-hover"><tr>	<td>Foto</td>	<td></td></tr>';if(!$fotolama){$fotolama='profile-default.jpg';}$admin .='<tr>	<td></td>	<td><img src="mod/karyawan/images/normal/'.$fotolama.'" height="120">	<input type="hidden" name="fotolama" value="'.$fotolama.'"></td></tr><tr>	<td>NIP</td>	<td><input type="hidden" name="nip" value="'.$nip.'">'.$nip.'</td></tr><tr>	<td>Nama Lengkap</td>	<td>	<input type="hidden" name="nama" value="'.$nama.'">'.$nama.'	</td></tr><tr>	<td>Departemen</td>	<td><input type="hidden" name="departemen" value="'.$departemen.'">'.getdepartemen($departemen).'</td></tr><tr>	<td>Jabatan</td>	<td><input type="hidden" name="jabatan" value="'.$jabatan.'">'.getjabatan($jabatan).'</td></tr><tr>	<td>Status</td>	<td><input type="hidden" name="status" value="'.$status.'">'.getstatus($status).'</td></tr><tr>	<td>Tipe</td>	<td><select name="tipe" class="form-control">';$hasil = $koneksi_db->sql_query("SELECT * FROM hrd_tipe ORDER BY id asc");$admin .= '<option value="">== Tipe Karyawan ==</option>';while ($datas =  $koneksi_db->sql_fetchrow ($hasil)){$pilihan = ($datas['id']==$tipe)?"selected":'';$admin .= '<option value="'.$datas['id'].'" '.$pilihan.'>'.$datas['tipe'].'</option>';}$admin .='</select></td></tr><tr>	<td>Tanggal Resign</td>	<td><input type="text" name="tglresign" value="'.$tglresign.'" size="30" class="form-control">'.$tanggalresign.'</td></tr><tr>	<td>Alasan Resign</td>	<td>	<input type="text" name="alasan" value="'.$alasan.'" size="50" class="form-control">	</td></tr><tr><td style="padding-right:5px;padding-bottom:5px;" valign="top">Lampiran</td><td style="padding-left:5px;padding-bottom:5px;" valign="top"><input type="file" name="gambartambahan"></td></tr><tr><td style="padding-right:5px;padding-bottom:5px;" valign="top">Preview Lampiran</td><td style="padding-left:5px;padding-bottom:5px;" valign="top">';$admin .= '<table><tr align="left">';$deleted = '<a href="admin.php?pilih=resign&mod=yes&aksi=hapus_photo&idkary='.$idkary.'" onclick="return confirm(\'Apakah Anda Ingin Menghapus Lampiran Ini ?\')" style="color:red"><img src="images/delete.png"></a>';if($lampiran){$admin .= '<td valign="middle" style="text-align:center;"><a  href="'.$url_situs.'/mod/karyawan/images/lampiran/'.$lampiran.'" rel="lightbox"><img src="'.$url_situs.'/images/jpg.jpg" alt="" border="0"style="max-height: 100px; max-width: 100px;"></a><br>'.$deleted.'';}$admin .= '</td></tr></table>';$admin .= '</td></tr><tr>	<td></td>	<td><input type="hidden" name="lampiranlama" value="'.$lampiranlama.'"><input type="submit" value="Simpan" name="submit" class="btn btn-success"></td></table></form>';}if($_GET['aksi'] =='hapus_photo'){$idkary = int_filter ($_GET['idkary']);$id = int_filter ($_GET['id']);$cek  = $koneksi_db->sql_query( "SELECT lampiran FROM hrd_karyawan WHERE id=$idkary" );while($data = mysql_fetch_array($cek)){ $lampiran = $data['lampiran'];$uploaddir = $normal2 . $lampiran;unlink($uploaddir);}$hapus = mysql_query ("update hrd_karyawan set lampiran='' WHERE `id`='$idkary'");	if ($hapus){$admin .= '<div class="sukses">Berhasil Dihapus</div>';	$style_include[] ='<meta http-equiv="refresh" content="3; url=admin.php?pilih=resign&mod=yes" />';}else {$admin .= '<div class="error">Gagal dihapus</div>';	}}if($_GET['aksi']=="cari_karyawan"){$admin.='<h5>Data Karyawan Resign</h5><table id="example"class="table table-striped table-bordered" cellspacing="0" width="100%"><thead><tr><th>NIP</th><th>Nama</th><th>TglLahir</th><th>Agama</th><th>Pendidikan</th><th>Jabatan</th><th>Status</th><th>Lama Kerja</th><th>Tgl Resign</th><th>Aksi</th></tr></thead>';$admin.='<tbody>';$hasil = $koneksi_db->sql_query( "SELECT * FROM hrd_karyawan where tipe='2'" );while ($data = $koneksi_db->sql_fetchrow($hasil)) { $nip=$data['nip'];$nama=$data['nama'];$gambar = $data['foto'];$date2 = $data['tglditerima'];$date3 = date("Y-m-d");$tgllahir 	= datetimes($data['tgllahir'],False,False);$tglresign 	= datetimes($data['tglresign'],False,False);$lamakerja =  floor(daysBetween($date2, $date3));$lamakerja2 = floor($lamakerja/365);$admin.='<tr><td>'.$nip.'</td><td>'.$nama.'</td><td>'.$tgllahir.'</td><td>'.getagama($data['agama']).'</td><td>'.getpendidikan($data['pendidikan_terakhir']).'</td><td>'.getjabatan($data['jabatan']).'</td><td>'.getstatus($data['status']).'</td><td>'.$lamakerja2.' Tahun</td><td>'.$tglresign.' Tahun</td><td><a class="text-danger" href="admin.php?pilih=karyawan&amp;mod=yes&amp;aksi=hapus_karyawan&amp;id='.$data['id'].'"><span class="btn btn-danger">Hapus</span></a><a class="text-info" href="?pilih=karyawan&amp;mod=yes&amp;aksi=edit_karyawan&amp;id='.$data['id'].'"><span class="btn btn-warning">Edit</span></a><a class="text-info" href="?pilih=resign&amp;mod=yes&amp;aksi=add_resign&amp;id='.$data['id'].'"><span class="btn btn-info">UnResign</span></a><a class="text-info" href="?pilih=karyawan&amp;mod=yes&amp;aksi=detail_karyawan&amp;id='.$data['id'].'"><span class="btn btn-success">Detail</span></a> </td>        </tr>';}   $admin.='</tbody></table>';}echo $admin;?>